<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>UXShari å­¸ç¿’å¹³å°ï½œæœƒå“¡å°ˆå€</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/general.css">
</head>
<body class="min-vh-100 d-flex flex-column">
<div id="navbar"></div>
  <!-- å‡ç´šæç¤ºæ¢ -->
  <div id="upgrade-banner" class="alert alert-info m-3 d-none" role="alert">
    <strong>ä½ ç›®å‰ä½¿ç”¨çš„æ˜¯å…è²»ç‰ˆ</strong>
    <p class="mb-0 small">å‡ç´šå¾Œå¯è§£é–é ç´„èˆ‡é€²éšèª²ç¨‹ ğŸ¯</p>
    <a href="/payment.html" class="btn btn-primary btn-sm">ç«‹å³å‡ç´š â†’</a>
  </div>

  <main class="container py-4 flex-grow-1">
    <!-- ä½¿ç”¨è€…å•å€™ -->
    <h1 id="greeting" class="h3 fw-bold">å—¨ï¼Œæ­¡è¿å›ä¾†</h1>
    <p id="greeting-sub" class="text-muted small"></p>

    <!-- Credits é¡¯ç¤º -->
    <p>å‰©é¤˜é»æ•¸ï¼š<span id="credits-count">0</span></p>

    <!-- èª²ç¨‹å¡ç‰‡ -->
    <section class="row g-3">
      <article class="col-12 col-md-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="h5">UX æŒ‘æˆ°åŒ…</h3>
            <p class="small text-muted">é›¶åŸºç¤å¿«é€Ÿå…¥é–€ UX/UIã€‚</p>
            <button class="btn btn-outline-primary w-100">æŸ¥çœ‹èª²ç¨‹ â†’</button>
          </div>
        </div>
      </article>

      <article class="col-12 col-md-6">
        <div class="card shadow-sm">
          <div class="card-body">
            <h3 class="h5">ä¸€å°ä¸€è¼”å°</h3>
            <p class="small text-muted">å°ˆå±¬å°å¸«è¼”å°ã€‚</p>
            <a id="mentorship-cta" href="/payment.html#mentorship" class="btn btn-primary w-100">
              ç«‹å³è§£é–å°ˆå±¬è¼”å° â†’
            </a>
          </div>
        </div>
      </article>
    </section>
  </main>
    <footer class="footer"></footer>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCZs2a35ENke7G8K7pzAMKCY3HOoi-IUcU",
      authDomain: "uxshari-670fd.firebaseapp.com",
      projectId: "uxshari-670fd",
    };

    if (!getApps().length) initializeApp(firebaseConfig);
    const auth = getAuth();
    const db = getFirestore();

    const encEmail = (e) => btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");

    onAuthStateChanged(auth, async (user) => {
      if (!user) return;

      document.getElementById("greeting").textContent = `å—¨ï¼Œ${user.email.split('@')[0]}ï¼`;
      document.getElementById("greeting-sub").textContent = user.email;

      let snap = await getDoc(doc(db, "users", user.uid));
      if (!snap.exists() && user.email) {
        snap = await getDoc(doc(db, "users_by_email", encEmail(user.email)));
      }

      if (snap.exists()) {
        const d = snap.data();

        // æ›´æ–° credits
        document.getElementById("credits-count").textContent = d.credits ?? 0;

        // å‡ç´šæç¤ºæ¢
        const upgradeBanner = document.getElementById("upgrade-banner");
        if (d.payment?.status === "paid") {
          upgradeBanner.classList.add("d-none");
        } else {
          upgradeBanner.classList.remove("d-none");
        }

        // Mentorship CTA
        const mentorshipCta = document.getElementById("mentorship-cta");
        if (d.entitlements?.mentorship) {
          mentorshipCta.textContent = "å‰å¾€é ç´„ â†’";
          mentorshipCta.href = "/booking.html#mentorship";
        }
      }
    });
  </script>
</body>
</html>